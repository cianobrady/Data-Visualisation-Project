<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>

    <style>
    
    svg{
      margin-left: auto;
      margin-right: auto;
      display: block;
    }


    h1, h2, h5 {
      text-align: center;
      font-family: "Trebuchet MS";
    }
    .axis { font: 20px sans-serif; }

    .legendsquares{
      stroke: black;
      stroke-width: 1px;
    }

    .legendparty{
      font-family: "Trebuchet MS";
      font-size: 20px;
    }

    .percentage{
      font-family: "Trebuchet MS";
      font-size: 16px;
    }

    .county {
          fill: none;
          stroke: #000;
          stroke-width: 2px;
    }
    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>

  </head>
  <body>
    <h1>The Irish Electoral College</h1>
    <h2>Visualising how the Irish 2020 General Election would be affected if the Taoiseach was chosen by an electoral college system.</h2>
    <script type="text/javascript">
    var abbrs = ["CK", "CM", "CL", "CE","CNC","CNW","CSC","CSW","DG","DC","DBN","DF","DNW","DSC","DBS","DR","DSW","DW","DL","GE","GW","KR","KN","LO","LIC","LCO","LW","LU","MA","ME","SL","TP","WD","MW","WX","WW","KS","DMW","RG"];
    var margin = {top: 20, right: 20, bottom:100, left: 40},
    width = 1400 - margin.right - margin.left,
    height = 675 - margin.top - margin.bottom;

    //define 2 SVGs
    var svg = d3.select("body")
      .append("svg")
      .attr("width", width+margin.right+margin.left)
      .attr("height", height+margin.top+margin.bottom)
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var barchart = d3.select("body")
      .append("svg")
      .attr("width", width+margin.right+margin.left)
      .attr("height", height+margin.top+margin.bottom)
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
    //define colour ranges and draw legend 
      var greenRange = d3.scaleLinear()
  	   .range(["white", "green"])
        .domain([-10,25]);
        var redRange = d3.scaleLinear()
  	   .range(["white", "#DF2935"])
        .domain([-10,25]);
        var blueRange = d3.scaleLinear()
  	   .range(["white", "#3772FF"])
        .domain([-10,25]);
    drawLegend();
    
    //read csv file
    d3.csv("https://raw.githubusercontent.com/cianobrady/Data-Visualisation-Project/main/templates/constituency_details.csv", function(error, data) {
      data.forEach(function(d) {
        d.constituency = d.constituency;
        d.electorate = +d.electorate;
        d.poll = +d.poll;
        d.abbr = d.abbr;
        d.seats = +d.seats;
        d.party = d.party;
        d.x = +d.x;
        d.y = +d.y;
        d.sf = +d.sf;
        d.ff = +d.ff;
        d.fg = +d.fg;
        d.con_abbr = d.con_abbr;
        d.partycol = d.partycol;
        d.gaeilge = d.gaeilge;
      });
      //draw initial donut chart
      var pieData = [data[0].sf, data[0].ff, data[0].fg];
      update(pieData, data[0].constituency, data[0].gaeilge,  data[0].electorate, data[0].poll, data[0].seats);
     
     // create map with squares
      var bgSquares =  svg.selectAll("square")
        .data(data)
        .enter().append("rect")
        .attr("class","square")
        .attr("x", function(d) { return 200+d.x; })
        .attr("y", function(d) { return 150+d.y; })
        .attr("width", function(d){
            return 20;
        })
        .attr("height", function(d){
            return 20*1;
        })
        .style("stroke", "black")
        .style("stroke-width", "4px")
        .style("opacity", "100%")
        .style("fill",  "none");

      var squares =  svg.selectAll("square")
        .data(data)
        .enter().append("rect")
        .attr("class","square")
        .attr("x", function(d) { return 200+d.x; })
        .attr("y", function(d) { return 150+d.y; })
        .attr("width", function(d){
            return 20;
        })
        .attr("height", function(d){
            return 20;
        })
        .style("stroke", "black")
        .style("stroke-width", "1px")
        .style("opacity", "100%")
        .style("fill", function(d){
            if(d.partycol=="SF"){
              var i = abbrs.indexOf(d.con_abbr);
              var margin = data[i].sf-d3.max([data[i].fg, data[i].ff]);
              return greenRange(margin);
            }
            else if(d.partycol=="FF"){
              var i = abbrs.indexOf(d.con_abbr);
              var margin = data[i].ff-d3.max([data[i].fg, data[i].sf]);
              return redRange(margin);
            }
            else if(d.partycol=="FG"){
              var i = abbrs.indexOf(d.con_abbr);
              var margin = data[i].fg-d3.max([data[i].ff, data[i].sf]);
              return blueRange(margin);
            }
        });

        //update donut chart data on click
        squares.on("click", function(d, i) {
            svg.selectAll("path").remove();
            svg.selectAll(".labels").remove();
            svg.selectAll("bar").remove();
            var county = d.con_abbr;
          
            d3.csv("https://raw.githubusercontent.com/cianobrady/Data-Visualisation-Project/main/templates/constituency_details.csv", function(data) {
                    var i = abbrs.indexOf(county);
                    var x = (data[i].poll/data[i].electorate)*100;
                    var y = 100-x;
                    var pieData = [x, y];

                    var sf = data[i].sf;
                    var ff = data[i].ff;
                    var fg = data[i].fg;
                    pieData = [sf, ff, fg];
                    update(pieData, data[i].constituency, data[i].gaeilge, data[i].electorate, data[i].poll, data[i].seats);
            });
            var coordinates = d3.mouse(this);
        bgSquares.transition()
          .duration(1000)
          .attr("x", function(c) { 
            if(coordinates[0]>800){return 200+c.x;}
            if(c.con_abbr==county){
                distance = 900 - coordinates[0];
                return 200+c.x + distance;
            }
            else{ return 200+c.x;}
          })
          .attr("y", function(c) { 
            if(coordinates[0]>800){return 150+c.y;}
            if(c.con_abbr==county){
                distance = 100 - coordinates[1];
                return 150+c.y + distance;
            }
            else{return 150+c.y;}
          });
          squares.transition()
          .duration(1000)
          .attr("x", function(c) { 
            if(coordinates[0]>800){
                return 200+c.x;
            }
            if(c.con_abbr==county){
                distance = 900 - coordinates[0];
                return 200+c.x + distance;
            }
            else{
                return 200+c.x;
            }
        
          })
          .attr("y", function(c) { 
            if(coordinates[0]>800){
                return 150+c.y;
            }
                if(c.con_abbr==county){
                    distance = 100 - coordinates[1];
                    return 150+c.y + distance;
                }
                else{
                    return 150+c.y;
                }
            
            });
          });
    
    //add buttons to change view
    var buttonPoints = svg.append("rect")
    .attr("class", "legendsquares")
        .attr("x", 460)
        .attr("y", 590)
        .attr("rx", 10)
        .attr("ry", 10)
        .attr("fill", "#9067c6")
        .attr("width", 80)
        .attr("height", 30);
    buttonPoints.on("click", function(){
      changeView(squares, bgSquares);
    });

    var buttonCon = svg.append("rect")
    .attr("class", "legendsquares")
        .attr("x", 610)
        .attr("y", 590)
        .attr("rx", 10)
        .attr("ry", 10)
        .attr("fill", "#CAC4CE")
        .attr("width", 80)
        .attr("height", 30);
    buttonCon.on("click", function(){
      constituencyView(squares, bgSquares);
    });

    var buttonMap = svg.append("rect")
    .attr("class", "legendsquares")
        .attr("x", 310)
        .attr("y", 590)
        .attr("rx", 10)
        .attr("ry", 10)
        .attr("fill", "#8D86C9")
        .attr("width", 80)
        .attr("height", 30);
     buttonMap.on("click", function(){
          squares.on("click", function(d, i) {
            svg.selectAll("path").remove();
            svg.selectAll(".labels").remove();
            svg.selectAll("bar").remove();
            var county = d.con_abbr;

            d3.csv("https://raw.githubusercontent.com/cianobrady/Data-Visualisation-Project/main/templates/constituency_details.csv", function(data) {
                    var i = abbrs.indexOf(county);
                    var x = (data[i].poll/data[i].electorate)*100;
                    var y = 100-x;
                    var pieData = [x, y];

                    var sf = data[i].sf;
                    var ff = data[i].ff;
                    var fg = data[i].fg;
                    pieData = [sf, ff, fg];
                    update(pieData, data[i].constituency, data[i].gaeilge, data[i].electorate, data[i].poll, data[i]. seats);
            });
            var coordinates = d3.mouse(this);
        bgSquares.transition()
          .duration(1000)
          .attr("x", function(c) { 
            if(coordinates[0]>800){
                return 200+c.x;
            }
            if(c.con_abbr==county){
                distance = 900 - coordinates[0];
                return 200+c.x + distance;
            }
            else{
                return 200+c.x;
            }
        
          })
          .attr("y", function(c) { 
            if(coordinates[0]>800){
                return 150+c.y;
            }
                if(c.con_abbr==county){
                    distance = 100 - coordinates[1];
                    return 150+c.y + distance;
                }
                else{
                    return 150+c.y;
                }
            
            });

            squares.transition()
          .duration(1000)
          .attr("x", function(c) { 
            if(coordinates[0]>800){
                return 200+c.x;
            }
            if(c.con_abbr==county){
                distance = 900 - coordinates[0];
                return 200+c.x + distance;
            }
            else{
                return 200+c.x;
            }
        
          })
          .attr("y", function(c) { 
            if(coordinates[0]>800){
                return 150+c.y;
            }
                if(c.con_abbr==county){
                    distance = 100 - coordinates[1];
                    return 150+c.y + distance;
                }
                else{
                    return 150+c.y;
                }
            
            });

            });
          svg.selectAll(".numbers").remove();
          svg.selectAll(".constituencyLabels").remove();
      //big labels
    svg.append("text")
    .attr("class", "biglabels")
        .attr("x", 320)
        .attr("y", 110)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("font-family", "Trebuchet MS")
        .text("Ireland");

    svg.append("text")
    
    .attr("class", "biglabels")
        .attr("x", 610)
        .attr("y", 170)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("font-family", "Trebuchet MS")
        .text("Dublin");

      bgSquares.transition()
      .duration(2000)
      .attr("x", function(d) { return 200+d.x; })
      .attr("y", function(d) { return 150+d.y; });
      squares.transition()
      .duration(2000)
      .attr("x", function(d) { return 200+d.x; })
      .attr("y", function(d) { return 150+d.y; });
    });

   
    /*
      SVG 2 = Points vs. Seats
     */

    var xscale = d3.scaleLinear()
    .domain([0,400])
    .range([0, 620]);

    var yscale = d3.scaleLinear()
        .domain([0,81])
        .range([250, 0]);

    var x_axis = d3.axisBottom()
    .tickValues([])
        .scale(xscale);

    var y_axis = d3.axisLeft()
    .tickValues([0, 40, 81])
        .scale(yscale);
    
    //get data from second csv file
     d3.csv("https://raw.githubusercontent.com/cianobrady/Data-Visualisation-Project/main/templates/party_results.csv", function(error, data) {
      data.forEach(function(d) {
        d.partyseat = d.partyseat;
        d.points = +d.points;
        d.seatcount = +d.seatcount;
      });

    //create two side by side barcharts
    barchart.selectAll("bar")
      .data(data)
         .enter().append("rect") .attr("fill", function(d){
            if(d.partyseat=="sf"){
                return "green";
            }
            else if(d.partyseat=="ff"){
                return "#DF2935";
            }
            else if(d.partyseat=="fg"){
                return "#3772FF";
            }
        })
        .style("stroke", "black")
        .style("stroke-width", "3px")
      
      .attr("width",  40)
      .attr("x", function(d, i) { if(i<4){return 100+150*i; }})
      
      .attr("height", function(d, i) { if(i<4){ return yscale(81-d.points); }})
      .attr("y", function(d, i) { if(i<4){ return 400 - yscale(81-d.points); }});
     
      barchart.selectAll("bar")
      .data(data)
         .enter().append("rect") .attr("fill", function(d){
            if(d.partyseat=="sf"){
                return "#90EE90";
            }
            else if(d.partyseat=="ff"){
                return "#ff3d41";
            }
            else if(d.partyseat=="fg"){
                return "skyblue";
            }
            else{
              return "yellow";
            }
        })
        .style("stroke", "black")
        .style("stroke-width", "3px")
      .attr("y", function(d, i) { if(i<4){ return 400 - yscale(81-d.seatcount); }})
      .attr("width",  40)
      .attr("x", function(d, i) { if(i<4){return 140+150*i; }})
      .attr("height", function(d, i) { if(i<4){ return yscale(81-d.seatcount); }});

      barchart.append("g")
        .attr("class", "axis")
        .attr("stroke-width", "2px")
        .attr("transform", "translate(50, 150)")
        .call(y_axis);
      
      barchart.append("g")
        .attr("class", "axis")
        .attr("stroke-width", "2px")
        .attr("transform", "translate(50, 400)")
        .call(x_axis);

        barchart.selectAll("dot")
        .data(data)
      .enter().append("text")
        .attr("dy", ".35em")
        .attr("font", "Trebuchet MS")
        .attr("font-size", "20px")
        .attr("text-anchor", "middle")
        .attr("x", function(d, i) {if(i<4){return 140+150*i; } })
        .attr("y", 420)
        .text(function(d, i) {
          if(i==0){
            return "Sinn Fein";
          }
          if(i==1){
            return "Fianna Fail";
          }
          if(i==2){
            return "Fine Gael";
          }
          if(i==3){
            return "Other";
          }

        });

        barchart.append("text")
        .attr("x",80)
        .attr("y", 100)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Points|Seats");
        barchart.append("text")
        .attr("x", 605)
        .attr("y", 40)
        .attr("dy", ".35em")
        .attr("font-size", "36px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Points vs. Seats");

        barchart.append("text")
        .attr("x", 1015)
        .attr("y", 230)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Electoral Points");

        barchart.append("text")
        .attr("x", 775)
        .attr("y", 230)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("0");

        barchart.append("text")
        .attr("x", 1255)
        .attr("y", 230)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("160");

        barchart.append("text")
        .attr("x", 775)
        .attr("y", 380)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("0");

        barchart.append("text")
        .attr("x", 1255)
        .attr("y", 380)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("160");

        barchart.append("text")
        .attr("x", 1015)
        .attr("y", 380)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Seats");

        //create 2 stacked bars
        var pos = 0;
       var points = barchart.selectAll("bar")
      .data(data)
         .enter().append("rect") .attr("fill", function(d){
            if(d.partyseat=="sf"){
                return "green";
            }
            else if(d.partyseat=="ff"){
                return "#DF2935";
            }
            else if(d.partyseat=="fg"){
                return "#3772ff";
            }
            else{
              return "yellow";
            }
        })
        .style("stroke", "black")
        .style("stroke-width", "3px")
      .attr("y", function(d, i) { return 170; })
      .attr("width",  function(d){
        return d.points*3;
      })
      .attr("x", function(d, i) { 
        var x = pos;
        pos+=d.points;
        return 775+x*3;
      })
      .attr("height", 40);
      points.on("mouseover", function (d){
        barchart.append("text")
        .attr("class", "guide")
        .attr("x", 1015)
        .attr("y", 150)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text(function (){
          if(d.partyseat=="sf"){
                return "Sinn Fein: "+ d.points;
            }
            else if(d.partyseat=="ff"){
                return "Fianna Fail: "+ d.points;
            }
            else if(d.partyseat=="fg"){
                return "Fine Gael: "+ d.points;
            }
        });
      });
      points.on("mouseout", function (d){
        d3.selectAll(".guide").remove();
      });

      pos = 0;
      var seats = barchart.selectAll("bar")
      .data(data)
         .enter().append("rect") .attr("fill", function(d){
            if(d.partyseat=="sf"){
                return "green";
            }
            else if(d.partyseat=="ff"){
                return "#DF2935";
            }
            else if(d.partyseat=="fg"){
                return "#3772ff";
            }
            else if(d.partyseat=="id"){
              return "black";
            }
            else if(d.partyseat=="gp"){
              return "limegreen";
            }
            else if(d.partyseat=="lab"){
              return "maroon";
            }
            else if(d.partyseat=="sd"){
              return "purple";
            }
            else if(d.partyseat=="spbp"){
              return "pink";
            }
        })
        .style("stroke", "black")
        .style("stroke-width", "3px")
      .attr("y", function(d, i) { if(d.partyseat!="other"){return 320;} })
      .attr("width",  function(d){
        if(d.partyseat!="other")
        {return d.seatcount*3;}
      })
      .attr("x", function(d, i) { 
        if(d.partyseat!="other")
        {var x = pos;
        pos+=d.seatcount;
        return 775+x*3;}
      })
      .attr("height", 40);


      seats.on("mouseover", function (d){
        barchart.append("text")
        .attr("class", "guide")
        .attr("x", 1015)
        .attr("y", 300)
        .attr("dy", ".35em")
        .attr("font-size", "24px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text(function (){
          if(d.partyseat=="sf"){
                return "Sinn Fein: "+d.seatcount;
            }
            else if(d.partyseat=="ff"){
              return "Fianna Fail: "+d.seatcount;
            }
            else if(d.partyseat=="fg"){
              return "Fine Gael: "+d.seatcount;
            }
            else if(d.partyseat=="id"){
              return "Independents: "+d.seatcount;
            }
            else if(d.partyseat=="gp"){
              return "Green Party: "+d.seatcount;
            }
            else if(d.partyseat=="lab"){
              return "Labour: "+d.seatcount;
            }
            else if(d.partyseat=="sd"){
              return "Social Democrats: "+d.seatcount;
            }
            else if(d.partyseat=="spbp"){
              return "Solidarity-PBP: "+d.seatcount;
            }
        });
      });
      seats.on("mouseout", function (d){
        d3.selectAll(".guide").remove();
      });
        });

 });

 // Creates/updates donut chart
function update(pieData, county, gaeilge,  electorate, poll, seats) {

  //generate piechart
    var color = d3.scaleOrdinal(['green','#DF2935','#3772FF']);
    var pie = d3.pie();

    var arc = d3.arc()
                .innerRadius(80)
                .outerRadius(130);

    var arcs = svg.selectAll("arc")
                .data(pie(pieData))
                .enter()
                .append("g")
                .attr("stroke", "black")
                .attr("transform", "translate(1050, 450)")
                .attr("class", "arc")

    arcs.append("path")
        .attr("fill", function(d, i) {
            return color(i);
        })
        .attr("d", arc);
    
    //add user interaction
    arcs.on("mouseenter", function (d, i){ 
      svg.append("text")
      .attr("class", "donutlabel")
      .attr("x", 1050)
      .attr("y", 430)
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "20px")
      .text(function (){
        if(i==0){
            return "Sinn Fein";
        }
        else if(i==1){
          return "Fianna Fail";
        }
        else if(i==2){
          return "Fine Gael";
        }
      });

      svg.append("text")
      .attr("class", "donutlabel")
      .attr("x", 1050)
      .attr("y", 470)
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "24px")
      .text(d.data + "%");

      svg.append('circle')
        .attr("cx", 1050)
        .attr("cy", 450)
        .attr('class', 'donutlabel')
        .attr('r', 75)
        .style('fill', function (d){
          if(i==0){
            return "green";
        }
        else if(i==1){
          return "#DF2935";
        }
        else if(i==2){
          return "#3772FF";
        }
        }) 
        .style('fill-opacity', 0.35);
    });

    arcs.on("mouseout", function (d){
      d3.selectAll(".donutlabel").remove();
    });

    //add legend
    svg.append("text")
      .attr("class", "labels")
      .attr("x", 1050)
      .attr("y", 75)
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "30px")
      .text(county);
      svg.append("text")
      .attr("class", "labels")
      .attr("x", 1050)
      .attr("y", 105)
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "20px")
      .text("("+gaeilge+")");
      svg.append("text")
      .attr("class", "labels")
      .attr("x", 950)
      .attr("y", 145)
      .attr("dy", ".35em")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "20px")
      .text("Electorate: "+ electorate);
      svg.append("text")
      .attr("class", "labels")
      .attr("x", 950)
      .attr("y", 175)
      .attr("dy", ".35em")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "20px")
      .text("Poll: "+ poll);
      svg.append("text")
      .attr("class", "labels")
      .attr("x", 950)
      .attr("y", 205)
      .attr("dy", ".35em")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "20px")
      .text("Electoral Points: "+ seats);

      svg.append("text")
      .attr("class", "labels")
      .attr("x", 1050)
      .attr("y", 270)
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .attr("font-family", "Trebuchet MS")
      .attr("font-size", "30px")
      .text("Voting Results");

}

//function to handle points button change
function changeView(squares, s){
  svg.selectAll(".biglabels").remove();
  svg.selectAll(".constituencyLabels").remove();
   //big labels
   svg.append("text")
    .attr("class", "numbers")
        .attr("x", 500)
        .attr("y", 150)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Electoral Points");
        svg.append("text")
    .attr("class", "numbers")
        .attr("x", 500)
        .attr("y", 180)
        .attr("dy", ".35em")
        .attr("font-size", "20px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("(81 Needed to Win)");

   svg.append("text")
    .attr("class", "numbers")
        .attr("x", 350)
        .attr("y", 550)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("67");

    svg.append("text")
    .attr("class", "numbers")
        .attr("x", 500)
        .attr("y", 550)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("64");
        
        svg.append("text")
    .attr("class", "numbers")
        .attr("x", 650)
        .attr("y", 550)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("29");

    var sfx = 0;
    var fgx = 0;
    var ffx = 0;
    var idx = 0;
    var sfy = 0;
    var fgy = 0;
    var ffy = 0;
    var idy = 0;

        squares.transition()
          .duration(2000)
          .attr("x", function(d, i) { 
        
        if(d.partycol=="SF"){
            var  x;
            x =  300+(sfx%5)*20;
            sfx++;
            
            return x; 
        }
        else if(d.partycol=="FF"){
            var  x;
            x =  450+(ffx%5)*20;
            ffx++;
            return x; 
        }
        
        else if(d.partycol=="FG"){
            var  x;
            x =  600+(fgx%5)*20;
            fgx++; 
            return x; 
        }
        
    })
    .attr("y", function(d) { 
        
        if(d.partycol=="SF"){
            console.log(d.con_abbr);
            var y = 500-Math.floor((sfy/5))*20;
            sfy++; 
            return y;
        }
        else if(d.partycol=="FF"){
            var y = 500-Math.floor((ffy/5))*20;
            ffy++; 
            return y;
        }
        else if(d.partycol=="FG"){
            var y = 500-Math.floor((fgy/5))*20;
            fgy++; 
            return y;
        }
    })
    .style("stroke", "black")
    .style("stroke-width", "1px");
    var sfx = 0;
    var fgx = 0;
    var ffx = 0;
    var idx = 0;
    var sfy = 0;
    var fgy = 0;
    var ffy = 0;
    var idy = 0;
    s.transition()
          .duration(2000)
          .attr("x", function(d) { 
        
        if(d.partycol=="SF"){
            var  x;
            x =  300+(sfx%5)*20;
            sfx++; 
            return x; 
        }
        else if(d.partycol=="FF"){
            var  x;
            x =  450+(ffx%5)*20;
            ffx++; 
            return x; 
        }
        
        else if(d.partycol=="FG"){
            var  x;
            x =  600+(fgx%5)*20;
            fgx++; 
            return x; 
        }
        
    })
    .attr("y", function(d) { 
        
        if(d.partycol=="SF"){
            console.log(d.con_abbr);
            var y = 500-Math.floor((sfy/5))*20;
            sfy++; 
            return y;
        }
        else if(d.partycol=="FF"){
            var y = 500-Math.floor((ffy/5))*20;
            ffy++; 
            return y;
        }
        else if(d.partycol=="FG"){
            var y = 500-Math.floor((fgy/5))*20;
            fgy++; 
            return y;
        }
    });

    squares.on("click", function (){
      console.log("pass");
    });
}

//function to handle button press that creates constituenct view
function constituencyView(squares, s){
  svg.selectAll(".biglabels").remove();
  svg.selectAll(".numbers").remove();
   //big labels
   svg.append("text")
    .attr("class", "constituencyLabels")
        .attr("x", 500)
        .attr("y", 150)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Constituencies Won");

   svg.append("text")
    .attr("class", "constituencyLabels")
        .attr("x", 350)
        .attr("y", 550)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("16");

    svg.append("text")
    .attr("class", "constituencyLabels")
        .attr("x", 500)
        .attr("y", 550)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("15");
        
        svg.append("text")
    .attr("class", "constituencyLabels")
        .attr("x", 650)
        .attr("y", 550)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("8");

  var sfx = 0;
    var fgx = 0;
    var ffx = 0;
    var idx = 0;
    var sfy = 0;
    var fgy = 0;
    var ffy = 0;
    var idy = 0;

        squares.transition()
          .duration(2000)
          .attr("x", function(d) { 
        
        if(d.partycol=="SF"){
            return 340; 
        }
        else if(d.partycol=="FF"){
            return 490; 
        }
        
        else if(d.partycol=="FG"){
            return 640; 
        }
        
    })
    .attr("y", function(d, i) { 
        
        if(d.partycol=="SF"){
            var y = 500-sfy*20;
            if(d.con_abbr!=squares.data()[i+1].con_abbr){
              sfy++; 
            } 
            return y;
        }
        else if(d.partycol=="FF"){
            var y =  500-ffy*20;
            if(d.con_abbr!=squares.data()[i+1].con_abbr){
              ffy++; 
            }  
            return y;
        }
        else if(d.partycol=="FG"){
            var y =  500-fgy*20;
            if(d.con_abbr!=="DL"){
              if(d.con_abbr!=squares.data()[i+1].con_abbr){
                fgy++; 
              }  
            }
            return y;
        }
    })
    .style("stroke", "black")
    .style("stroke-width", "1px");
    var sfx = 0;
    var fgx = 0;
    var ffx = 0;
    var idx = 0;
    var sfy = 0;
    var fgy = 0;
    var ffy = 0;
    var idy = 0;
    s.transition()
          .duration(2000)
          .attr("x", function(d) { 
        
        if(d.partycol=="SF"){
            return 340; 
        }
        else if(d.partycol=="FF"){
            return 490; 
        }
        
        else if(d.partycol=="FG"){
            return 640; 
        }
        
    })
    .attr("y", function(d, i) { 
        
        if(d.partycol=="SF"){
            var y = 500-sfy*20;
            if(d.con_abbr!=squares.data()[i+1].con_abbr){
              sfy++; 
            } 
            return y;
        }
        else if(d.partycol=="FF"){
            var y =  500-ffy*20;
            if(d.con_abbr!=squares.data()[i+1].con_abbr){
              ffy++; 
            }  
            return y;
        }
        else if(d.partycol=="FG"){
            var y =  500-fgy*20;
            if(d.con_abbr!="DL"){
              if(d.con_abbr!=squares.data()[i+1].con_abbr){
                fgy++; 
              }  
            }
            return y;
        }
    });

    squares.on("click", function (){
      console.log("hello");
    });
}

function drawLegend(){
  //gradients
  var greenGradient = svg.append("defs")
            .append("linearGradient")
            .attr("id", "green-gradient");

            greenGradient.append("stop")
            .attr("offset", "0%")
            .attr("stop-color", "white");

            greenGradient.append("stop")
            .attr("offset", "100%")
            .attr("stop-color", "green");
  var redGradient = svg.append("defs")
            .append("linearGradient")
            .attr("id", "red-gradient");

            redGradient.append("stop")
            .attr("offset", "0%")
            .attr("stop-color", "white");

            redGradient.append("stop")
            .attr("offset", "100%")
            .attr("stop-color", "#DF2935");

            
  var blueGradient = svg.append("defs")
            .append("linearGradient")
            .attr("id", "blue-gradient");

            blueGradient.append("stop")
            .attr("offset", "0%")
            .attr("stop-color", "white");

            blueGradient.append("stop")
            .attr("offset", "100%")
            .attr("stop-color", "#3772FF");
  //background map
  svg.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("rx", 30)
        .attr("ry", 30)
        .attr("fill", "skyblue")
        .attr("width", 800)
        .attr("opacity", .2)
        .attr("height", 675);

  svg.append("rect")
        .attr("x", 800)
        .attr("y", 0)
        .attr("rx", 30)
        .attr("ry", 30)
        .attr("fill", "#90EE90")
        .attr("width", 500)
        .attr("opacity", .2)
        .attr("height", 675);
    
  barchart.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("rx", 30)
        .attr("ry", 30)
        .attr("fill", "#ffcccb")
        .attr("width", 1300)
        .attr("opacity", .2)
        .attr("height", 450);
  //button labels
  svg.append("text")
        .attr("x", 350)
        .attr("y", 635)
        .attr("dy", ".35em")
        .attr("font-size", "20px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Map View");
  svg.append("text")
        .attr("x", 500)
        .attr("y", 635)
        .attr("dy", ".35em")
        .attr("font-size", "20px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Points");
  svg.append("text")
        .attr("x", 650)
        .attr("y", 635)
        .attr("dy", ".35em")
        .attr("font-size", "20px")
        .attr("text-anchor", "middle")
        .attr("font-family", "Trebuchet MS")
        .text("Constituency");
  //big labels
    svg.append("text")
    .attr("class", "biglabels")
        .attr("x", 320)
        .attr("y", 110)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("font-family", "Trebuchet MS")
        .text("Ireland");

    svg.append("text")
    
    .attr("class", "biglabels")
        .attr("x", 610)
        .attr("y", 170)
        .attr("dy", ".35em")
        .attr("font-size", "30px")
        .attr("font-family", "Trebuchet MS")
        .text("Dublin");
    //percentages
    svg.append("text")
    .attr("class", "percentage")
        .attr("x", 15)
        .attr("y", 110)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("0%");
        svg.append("text")
    .attr("class", "percentage")
        .attr("x", 15)
        .attr("y", 180)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("0%");
        svg.append("text")
    .attr("class", "percentage")
        .attr("x", 15)
        .attr("y", 250)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("0%");
        svg.append("text")
    .attr("class", "percentage")
        .attr("x", 200)
        .attr("y", 110)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("25%");
        svg.append("text")
    .attr("class", "percentage")
        .attr("x", 200)
        .attr("y", 180)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("25%");
        svg.append("text")
    .attr("class", "percentage")
        .attr("x", 200)
        .attr("y", 250)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("25%");
    //party legend
    svg.append("text")
        .attr("x", 25)
        .attr("y", 60)
        .attr("dy", ".35em")
        .attr("font-family", "Trebuchet MS")
        .attr("font-size", "25px")
        .text("Margin of Victory");

    

    var rectangle = svg.append("rect")
    .attr("class", "legendsquares")
        .attr("x", 30)
        .attr("y", 100)
        .attr("fill", "url(#green-gradient)")
        .attr("width", 150)
        .attr("height", 20);

    svg.append("text")
    .attr("class", "legendparty")
        .attr("x", 105)
        .attr("y", 135)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("Sinn Fein");

    var rectangle = svg.append("rect")
    .attr("class", "legendsquares")
        .attr("x", 30)
        .attr("y", 170)
        .attr("fill", "url(#red-gradient)")
        .attr("width", 150)
        .attr("height", 20);

    svg.append("text")
    .attr("class", "legendparty")
        .attr("x", 105)
        .attr("y", 210)
        .attr("text-anchor", "middle")
        .attr("dy", ".35em")
        .text("Fianna Fail");

    var rectangle = svg.append("rect")
    .attr("class", "legendsquares")
        .attr("x", 30)
        .attr("y", 240)
        .attr("fill", "url(#blue-gradient)")
        .attr("width", 150)
        .attr("height", 20);

    svg.append("text")
    .attr("class", "legendparty")
        .attr("x", 60)
        .attr("y", 280)
        .attr("dy", ".35em")
        .text("Fine Gael");

    //explanation
    var rectangle = svg.append("rect")
        .attr("x", 30)
        .attr("y", 350)
        .attr("fill", "yellow")
        .attr("width", 20)
        .attr("stroke", "black")
        .attr("stroke-width", "1.5px")
        .attr("height", 20);

        var constituency =  svg.selectAll("square")
        .data([20, 40, 20, 40])
        .enter().append("rect")
        .attr("class","square")
        .attr("x", function(d) { return d; })
        .attr("y", function(d, i) { 
          if(i<=1){
            return 400;
          }
          else{
              return 420;
          }
         })
        .attr("width", function(d){
            return 20;
        })
        .attr("height", function(d){
            return 20;
        })
        .style("stroke", "black")
        .style("stroke-width", "3px")
        .style("opacity", "100%")
        .style("fill",  "none");

        var constituency =  svg.selectAll("square")
        .data([20, 40, 20, 40])
        .enter().append("rect")
        .attr("class","square")
        .attr("x", function(d) { return d; })
        .attr("y", function(d, i) { 
          if(i<=1){
            return 400;
          }
          else{
              return 420;
          }
         })
        .attr("width", function(d){
            return 20;
        })
        .attr("height", function(d){
            return 20;
        })
        .style("stroke", "black")
        .style("stroke-width", "1px")
        .style("opacity", "100%")
        .style("fill",  "yellow");


        svg.append("text")
    .attr("class", "legendparty")
        .attr("x", 60)
        .attr("y", 360)
        .attr("dy", ".35em")
        .text("Electoral Point");

        svg.append("text")
    .attr("class", "legendparty")
        .attr("x", 70)
        .attr("y", 420)
        .attr("dy", ".35em")
        .text("Constituency");
}
  </script>

  </body>
</html>